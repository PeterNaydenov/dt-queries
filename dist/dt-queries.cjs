"use strict";exports.add=function(e,t,n){const s=[];e.look((({name:t,flatData:n,breadcrumbs:s,next:o})=>(e.set(t,n),s.includes("/")&&e.connect([s]),o()))),t.query((t=>{t.look((({name:t,flatData:o,breadcrumbs:r,next:c})=>{const a=o instanceof Array,i=n(r);if(null==i){e.set(t,o);const n=new RegExp(`/${t}$`),a=r.replace(n,"").split("/").pop();return s.push(`${a}/${t}`),c()}const[,l]=i;if(a)o.forEach((n=>{l.includes(n)||e.push(t,n)}));else{Object.entries(o).forEach((([n,s])=>{void 0===l[n]&&e.save(t,n,s)}))}return c()}))})),s.length>0&&e.connect(s)},exports.append=function(e,t){e.look((({name:n,flatData:s,breadcrumbs:o,next:r})=>{const c=t.index(o),a=s instanceof Array;if(!c)return e.set(n,s),o.includes("/")&&e.connect([o]),r();const[,i]=c,l=i instanceof Array,f=a?[...s]:[];if(a!=l)e.set(n,i);else if(a){Object.entries(i).forEach((([e,t])=>{f.includes(t)||f.push(t)})),e.set(n,f)}else{const t=Object.entries(s),o={};t.forEach((([e,t])=>{i.hasOwnProperty(e)?o[e]=`${t},${i[e]}`:o[e]=t})),e.set(n,o)}return o.includes("/")&&e.connect([o]),r()}))},exports.change=function(e,t){const n=[];if(!t.index&&"function"!=typeof t.index)return null;e.look((({name:s,flatData:o,breadcrumbs:r,next:c})=>{const a=o instanceof Array,i=t.index(r);let l=null;if(i){const c=i[1];if(a!=c instanceof Array)e.set(s,c);else if(a){c.length===o.length&&c.every(((e,t)=>e===o[t]))?e.set(s,[]):e.set(s,c)}else{const a=Object.entries(o),i={};a.forEach((([s,o])=>{const a=c[s];o!==a&&(i[s]=a),l=t.index(`${r}/${s}`),l&&(e.set(s,l),n.push(`${l[2]}/${l[0]}`),l=null)})),e.set(s,i)}}else a?e.set(s,[]):e.set(s,{});return r.includes("/")&&e.connect([r]),c()}))},exports.combine=function(e,t){const n=[];e.look((({name:s,flatData:o,breadcrumbs:r,links:c,next:a})=>{let i;const l=o instanceof Array;if(n.push(r),l){let c=[],l=[];if(o.forEach(((s,o)=>{const a=`${r}/${o}`,i=t.index(a);if(i){const t=i[1];t instanceof Array?t.push(s):t.___history=s,e.set(o,t),n.push(a),l.push(a)}else c.push(s)})),i=t.index(r),i){i[1]instanceof Array?(i[1].forEach((e=>{c.includes(e)||c.push(e)})),e.set(s,c)):c.push(i[1])}else{e.set(s,c);let n=r.split("/");n.pop();let o=n.join("/"),a=t.index(o)[1][s];a&&e.push(s,a)}return r.includes("/")&&e.connect([r]),e.connect(l),a()}let f=Object.entries(o),u=Object.keys(o);return e.set(s,{}),r.includes("/")&&e.connect([r]),i=t.index(r),f.forEach((([o,c])=>{const a=`${r}/${o}`,l=t.index(a);if(l){l[1]instanceof Array?(e.set(o,[]),e.push(o,c),l[1].forEach((t=>e.push(o,t)))):(e.set(o,l[1]),e.save(o,"___history",c)),e.connect([a])}else{const[,t]=i||[],r=t[o];r?(e.set(o,[c,r]),e.connect([a]),n.push(a)):e.save(s,o,c)}})),t.query((t=>{let n=c.map((([,e])=>e));t.look((({key:t,value:o,breadcrumbs:c,next:a})=>{if(c!==r)return a();n.includes(t)||u.includes(t)||null==t||e.save(s,t,o)}))})),a()})),t.query((t=>{t.look((({name:t,flatData:s,breadcrumbs:o,next:r})=>{if(!n.includes(o))return e.set(t,s),e.connect([o]),r()}))}))},exports.different=function(e,t,n){t.query((t=>{t.look((({name:t,breadcrumbs:s,flatData:o,next:r})=>{const c=n(s);if(!c)return e.set(t,o),r();const a=o instanceof Array,[,i]=c;if(a!==i instanceof Array)e.set(t,o);else if(a){if(!(o.length===i.length&&o.every(((e,t)=>e===i[t]))))return e.set(t,o),r();const n=[];o.forEach((e=>{i.includes(e)||n.push(e)})),e.set(t,n)}else{const n=Object.entries(o),s={};n.forEach((([e,t])=>{i.hasOwnProperty(e)||(s[e]=t),t!==i[e]&&(s[e]=t)})),e.set(t,s)}return r()})),t.look((({links:t,next:n})=>{const s=t.map((([e,t])=>`${e}/${t}`));return e.connect(s),n()}))}))},exports.identical=function(e,t){if(!t.index&&"function"!=typeof t.index)return null;e.look((({name:n,flatData:s,breadcrumbs:o,next:r})=>{const c=s instanceof Array,a=t.index(o);if(a){const t=a[1];if(c!=t instanceof Array)return r();if(c){const o=[];s.forEach(((e,n)=>{e===t[n]&&o.push(e)})),e.set(n,o)}else{const o=Object.entries(s),r={};o.forEach((([e,n])=>{n==t[e]&&(r[e]=n)})),e.set(n,r)}o.includes("/")&&e.connect([o])}return r()}))},exports.insert=function(e,t){const n=[];e.look((({name:s,flatData:o,breadcrumbs:r,next:c})=>{const a=t.index(r),i=o instanceof Array;if(n.push(r),!a)return e.set(s,o),r.includes("/")&&e.connect([r]),c();const[,l]=a,f=l instanceof Array,u=i?[...o]:[];if(i){if(f)l.forEach((e=>{u.includes(e)||u.push(e)}));else{Object.entries(l).forEach((([e,t])=>{u.includes(t)||u.push(t)}))}e.set(s,u)}else e.set(s,o);return r.includes("/")&&e.connect([r]),c()})),t.query((t=>{t.look((({name:t,flatData:s,breadcrumbs:o,next:r})=>{if(!n.includes(o)){s instanceof Array&&(e.set(t,s),e.connect([o]))}return r()}))}))},exports.joinSegments=function(e){const t={};e.look((({name:n,flatData:s,breadcrumbs:o,links:r,next:c})=>{if(e.set(n,s),"root"===n)return c();if(n===o&&e.connect([`root/${n}`]),r.forEach((([e,n])=>t[n]=[e,n])),t[n]){const[s,o]=t[n];e.connect([`${s}/${o}`])}return c()}))},exports.keepSegments=function(e,t=[]){const n=[];let s;e.use("root").look((({name:e,flatData:t,next:o})=>(n.push(e),"root"===e&&(s=t instanceof Array?"array":"object"),o())));const o=n.filter((e=>t.includes(e))),r=0===o.length,c=1===o.length;r&&("array"===s?e.set("root",[]):e.set("root",{})),o.forEach((t=>{let n=[];e.from(t).look((({name:t,flatData:s,breadcrumbs:o,links:r,next:a})=>{t===o&&c?e.set("root",s):e.set(t,s);const i=c?r.map((([e,t])=>`root/${t}`)):r.map((([e,t])=>`${e}/${t}`));return n=[...n,...i],a()})),e.connect(n)}))},exports.missing=function(e,t){if(!t.index&&"function"!=typeof t.index)return null;e.look((({name:n,flatData:s,breadcrumbs:o,next:r})=>{const c=s instanceof Array,a=t.index(o);if(!a)return e.set(n,s),r();const i=a[1];if(c!=i instanceof Array)e.set(n,s);else if(c){const t=[];s.forEach(((e,n)=>{i.includes(e)||t.push(e)})),e.set(n,t)}else{const t=Object.entries(s),o={};t.forEach((([e,t])=>{null==i[e]&&(o[e]=t)})),e.set(n,o)}return r()})),e.look((({links:t,next:n})=>{const s=t.map((([e,t])=>`${e}/${t}`));return e.connect(s),n()}))},exports.overwrite=function(e,t){const n=[];e.look((({name:s,flatData:o,breadcrumbs:r,next:c})=>{const a=t.index(r),i=o instanceof Array;if(n.push(r),!a)return e.set(s,o),r.includes("/")&&e.connect([r]),c();const[,l]=a;if(i!==l instanceof Array)e.set(s,l);else if(i)if("..."==l[0]){let t=[...o];l.forEach((e=>{"..."!=e&&(t.includes(e)||t.push(e))})),e.set(s,t)}else e.set(s,l);else{let t={...o};Object.entries(l).forEach((([e,n])=>t[e]=n)),e.set(s,t)}return r.includes("/")&&e.connect([r]),c()})),t.query((t=>{t.look((({name:t,flatData:s,breadcrumbs:o,next:r})=>(n.includes(o)||(e.set(t,s),e.connect([o])),r())))}))},exports.prepend=function(e,t){e.look((({name:n,flatData:s,breadcrumbs:o,next:r})=>{const c=t.index(o),a=s instanceof Array;if(!c)return e.set(n,s),o.includes("/")&&e.connect([o]),r();const[,i]=c,l=i instanceof Array,f=a?[...s]:[];if(a!=l)e.set(n,i);else if(a){Object.entries(i).forEach((([e,t])=>{f.includes(t)||f.push(t)})),e.set(n,f)}else{const t=Object.entries(s),o={};t.forEach((([e,t])=>{i.hasOwnProperty(e)?o[e]=`${i[e]},${t}`:o[e]=t})),e.set(n,o)}return o.includes("/")&&e.connect([o]),r()}))},exports.removeSegments=function(e,t=[]){const n=[];let s;e.use("root").look((({name:e,flatData:o,next:r})=>(t.includes(e)||n.push(e),"root"===e&&(s=o instanceof Array?"array":"object"),r())));const o=0===n.length,r=1===n.length;o&&("array"===s?e.set("root",[]):e.set("root",{})),n.forEach((t=>{let n=[];e.from(t).look((({name:t,flatData:s,breadcrumbs:o,links:c,next:a})=>{t===o&&r?e.set("root",s):e.set(t,s);const i=r?c.map((([e,t])=>`root/${t}`)):c.map((([e,t])=>`${e}/${t}`));return n=[...n,...i],a()})),e.connect(n)}))},exports.same=function(e,t){if(!t.index&&"function"!=typeof t.index)return null;e.look((({name:n,flatData:s,breadcrumbs:o,next:r})=>{const c=t.index(o),a=s instanceof Array;if(!c)return e.set(n,a?[]:{}),r();const[,i]=c;if(a!==i instanceof Array)e.set(n,i);else if(a)e.set(n,i);else{const t=Object.entries(s),o={};t.forEach((([e,t])=>{const n=i[e];void 0!==n&&(o[e]=n)})),e.set(n,o)}return r()})),e.look((({links:t,next:n})=>{const s=t.map((([e,t])=>`${e}/${t}`));return e.connect(s),n()}))},exports.splitSegments=function(e){const t={};e.look((({name:n,flatData:s,links:o,next:r})=>{if(o.forEach((([e,n])=>{"root"!==e&&(t[n]=[e,n])})),e.set(n,s),t[n]){const[s,o]=t[n];e.connect([`${s}/${o}`])}return r()}))},exports.update=function(e,t){e.look((({name:n,flatData:s,breadcrumbs:o,next:r})=>{const c=t.index(o),a=s instanceof Array;if(!c)return e.set(n,s),o.includes("/")&&e.connect([o]),r();const[,i]=c;if(a!==i instanceof Array)e.set(n,s);else if(a)e.set(n,i);else{e.set(n,{}),Object.entries(s).forEach((([t,s])=>{i.hasOwnProperty(t)?e.save(n,t,i[t]):e.save(n,t,s)}))}return o.includes("/")&&e.connect([o]),r()}))},exports.updateState=function(e,t){const n=t.export("root")[0][1],s=[];let o=null;e.use("root").look((({flatData:e,breadcrumbs:t,next:n})=>"root"===t?(o=e,n()):(s.push(t),n()))),o instanceof Array?e.set("root",[]):e.set("root",{}),s.forEach((s=>{let r=!1;const c={};t.query((t=>{t.from(s).look((({name:t,flatData:n,breadcrumbs:s,links:o,next:a})=>{if(r=!0,e.set(t,n),c.hasOwnProperty(s)){const[t,n]=c[s];e.connect([`${t}/${n}`])}return o.forEach((([e,t])=>c[`${s}/${t}`]=[e,t])),a()}))})),!r&&n.hasOwnProperty(s)&&(r=!0,e.save("root",s,o[s])),r||e.from(s).look((({name:t,flatData:n,breadcrumbs:s,links:o,next:r})=>{if(e.set(t,n),c.hasOwnProperty(s)){const[t,n]=c[s];e.connect([`${t}/${n}`])}return o.forEach((([e,t])=>c[`${s}/${t}`]=[e,t])),r()}))})),Object.entries(o).forEach((([s,o])=>{const r={};let c=!1;t.query((t=>{t.from(s).look((({name:t,flatData:n,breadcrumbs:s,links:o,next:a})=>{if(c=!0,e.set(t,n),r.hasOwnProperty(s)){const[t,n]=r[s];e.connect([`${t}/${n}`])}return o.forEach((([e,t])=>r[`${s}/${t}`]=[e,t])),a()}))})),!c&&n.hasOwnProperty(s)&&(c=!0,e.save("root",s,n[s])),c||e.save("root",s,o)}))};
